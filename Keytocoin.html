<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KeytoCoin Wallet ‚Äì Blockchain Online</title>
  <style>
    body { 
      background:#111;
      color:#0f0;
      font-family:monospace;
      padding:20px;
      overflow:hidden;
    }
    button,input{ 
      padding:6px 10px;
      background:#222;
      color:#0f0;
      border:1px solid #0f0;
      margin:5px;
    }
    #wallet,#logs{ 
      margin-top:20px;
      padding:10px;
      background:#000;
      border:1px solid #0f0;
      max-height:250px;
      overflow:auto;
    }
    h2{ color:#0f0; }
    .log-entry { border-bottom:1px solid #333;padding:4px; }
    .block { color:#f33; }
    .unblock { color:#3f3; }

    /* animasi hujan coin */
    .coin {
      position:absolute;
      top:-50px;
      color:#0f0;
      font-size:18px;
      animation: fall linear forwards;
      pointer-events:none;
      text-shadow:0 0 5px #0f0,0 0 10px #0f0;
    }
    @keyframes fall {
      to { transform:translateY(110vh); opacity:0; }
    }
  </style>
</head>
<body>
  <h1>üåç KeytoCoin Wallet</h1>

  <div>
    <input id="address" placeholder="Wallet Address">
    <button onclick="checkWallet()">Check Wallet</button>
    <button onclick="mine()">Mine</button>
  </div>

  <div>
    <input id="to" placeholder="To Address">
    <input id="amount" placeholder="Amount">
    <button onclick="send()">Send</button>
  </div>

  <div>
    <select id="token">
      <option value="USDT">USDT</option>
      <option value="ETH">ETH</option>
      <option value="BTC">BTC</option>
    </select>
    <input id="swapAmount" placeholder="Amount">
    <button onclick="swap()">Swap</button>
  </div>

  <button onclick="loadLogs()">AI Logs</button>

  <div id="wallet"></div>
  <div id="logs"></div>

  <script>
    const API = "http://localhost:3000";

    async function checkWallet() {
      let addr = document.getElementById("address").value;
      let res = await fetch(`${API}/wallet/${addr}`);
      let data = await res.json();
      document.getElementById("wallet").innerHTML = "<h2>Wallet Info</h2><pre>"+JSON.stringify(data,null,2)+"</pre>";
    }

    async function mine() {
      let addr = document.getElementById("address").value;
      let res = await fetch(`${API}/mine`, {
        method:"POST", headers:{'Content-Type':'application/json'},
        body:JSON.stringify({address:addr})
      });
      let data = await res.json();
      alert(JSON.stringify(data));
      checkWallet();
    }

    async function send() {
      let from = document.getElementById("address").value;
      let to = document.getElementById("to").value;
      let amount = parseInt(document.getElementById("amount").value);
      let res = await fetch(`${API}/send`, {
        method:"POST", headers:{'Content-Type':'application/json'},
        body:JSON.stringify({from,to,amount})
      });
      let data = await res.json();
      alert(JSON.stringify(data));
      checkWallet();
    }

    async function swap() {
      let from = document.getElementById("address").value;
      let amount = parseInt(document.getElementById("swapAmount").value);
      let token = document.getElementById("token").value;
      let res = await fetch(`${API}/swap`, {
        method:"POST", headers:{'Content-Type':'application/json'},
        body:JSON.stringify({from,token,amount})
      });
      let data = await res.json();
      alert(JSON.stringify(data));
      checkWallet();
    }

    async function loadLogs() {
      let res = await fetch(`${API}/ai-logs`);
      let logs = await res.json();
      let html = "<h2>AI Security Logs</h2>";
      if(logs.length === 0) {
        html += "<p>No logs yet.</p>";
      } else {
        logs.forEach(l=>{
          let type = l.action === "BLOCK" ? "block" : "unblock";
          let time = new Date(l.time).toLocaleString();
          html += `<div class="log-entry ${type}">[${time}] ${l.action} ‚Äì ${l.address} (${l.reason})</div>`;
        });
      }
      document.getElementById("logs").innerHTML = html;
    }

    // Hujan coin animasi
    function spawnCoin() {
      const coin = document.createElement("div");
      coin.className = "coin";
      coin.innerText = "üí∞KTC";
      coin.style.left = Math.random()*100+"vw";
      coin.style.animationDuration = (2+Math.random()*3)+"s";
      document.body.appendChild(coin);
      setTimeout(()=>coin.remove(), 5000);
    }
    setInterval(spawnCoin, 500);
  </script>
</body>
</html>
