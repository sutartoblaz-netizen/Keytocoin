<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KeytoCoin Wallet</title>
<style>
body { background:#111;color:#0f0;font-family:monospace;padding:20px;overflow-x:hidden; }
button,input{ padding:6px 10px;background:#222;color:#0f0;border:1px solid #0f0;border-radius:6px;margin:2px; }
input{ width:250px; }
#log{ max-height:200px;overflow-y:auto;background:#222;padding:10px;border:1px solid #0f0; }

/* Coin rain */
.coin{
  position:fixed;top:-60px;width:50px;height:50px;border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#ffd700,#c99700);
  box-shadow:0 0 10px #ff0,inset 0 0 10px #c90;
  display:flex;align-items:center;justify-content:center;
  font-weight:bold;color:#111;font-size:14px;
  animation:fall linear forwards;z-index:-1;
}
@keyframes fall{ to{ transform:translateY(110vh) rotate(360deg); opacity:0.8; } }

/* Brick Text */
.brick-text{
  font-size:30px;font-weight:bold;display:inline-block;
  background:linear-gradient(90deg,#ff0000,#ff6600,#ffcc00);
  background-size:200% auto;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:brickmove 3s linear infinite;
}
@keyframes brickmove{
  0%{background-position:0% center;}
  100%{background-position:200% center;}
}
</style>
</head>

<body>
<h2> KeytoCoin </h2>
<button id="createWalletBtn">Create Wallet</button>
<button id="importWalletBtn">Import Wallet</button>
<button id="clearWalletBtn">Clear Wallet</button>
<button id="startMiningBtn">Start Mining</button>
<button id="stopMiningBtn">Stop Mining</button>
<button id="saveAddressBtn">Save Address</button>
<button id="togglePrivBtn">Show/Hide Private Key</button>

<p>Address: <span id="address"></span></p>
<p>Private: <span id="privkey"></span></p>
<p>Balance: <span id="balance">0</span> KTC</p>

<hr>
<h3>Mining</h3>
<p>Mined Blocks: <span id="blocks">0</span></p>
<p>Total Supply: <span id="supply">0</span> / 17,000,000 KTC</p>

<h3>Send Transaction</h3>
<input id="to" placeholder="Recipient Address">
<input id="amount" type="number" placeholder="Amount">
<button id="sendBtn">Send</button>

<hr>
<h3>Saved Wallets</h3>
<ul id="savedWallets"></ul>

<hr>
<h3>Blockchain Log</h3>
<pre id="log"></pre>

<div align="center"><span class="brick-text">‚õì‚õèKEYTOCOIN‚õè‚õì</span></div>
<div align="center"><span class="brick-text">‚õì‚õèBLOKCHAIN‚õè‚õì</span></div>

<!-- Import Wallet Modal -->
<div id="importModal" 
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
     background:rgba(0,0,0,0.8); backdrop-filter:blur(3px);
     align-items:center; justify-content:center; z-index:999;">
  
  <div style="background:#111; border:1px solid #0f0; padding:20px; border-radius:8px;">
    <h3>Import Private Key</h3>
    <input id="importPriv" type="text" placeholder="Paste Private Key" style="width:300px;">
    <br><br>
    <button id="confirmImportBtn">Import</button>
    <button onclick="document.getElementById('importModal').style.display='none'">Cancel</button>
  </div>
</div>

<script>
const API = "http://localhost:3005";

let privKey=null, address=null, miningInterval=null;
let showPriv = false;

function log(msg){
  const logEl=document.getElementById("log");
  const div=document.createElement("div");
  div.textContent=msg; logEl.prepend(div);
}

async function hash(data){
  const buf=new TextEncoder().encode(data);
  const digest=await crypto.subtle.digest("SHA-256",buf);
  return Array.from(new Uint8Array(digest)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function createWallet(){
  const arr=new Uint8Array(32); crypto.getRandomValues(arr);
  privKey=Array.from(arr).map(b=>b.toString(16).padStart(2,"0")).join("");
  const addrHash=await hash(privKey); address=addrHash.slice(0,32);
  localStorage.setItem("KTC_Wallet",JSON.stringify({privKey,address}));
  log("‚úÖ Wallet created!"); updateDisplay();
}

function clearWallet(){
  localStorage.removeItem("KTC_Wallet");
  privKey=null; address=null;
  stopMining(); updateDisplay();
  log("üóëÔ∏è Wallet cleared.");
  localStorage.removeItem("KTC_Saved");
  renderSavedWallets();
}

async function getWalletInfo(){
  if(!address) return {balance:0,blocks:0,supply:0};
  try{
    const res=await fetch(`${API}/wallet/${address}`);
    return await res.json();
  }catch(e){ return {balance:0,blocks:0,supply:0}; }
}

async function updateDisplay(){
  document.getElementById("address").innerText = address||"";
  document.getElementById("privkey").innerText =
    privKey ? (showPriv ? privKey : privKey.slice(0,16)+"...") : "";
  const info = await getWalletInfo();
  document.getElementById("balance").innerText = info.balance;
  document.getElementById("blocks").innerText = info.blocks;
  document.getElementById("supply").innerText = info.supply;
}

async function mineBlock(){
  if(!address){ log("‚ö†Ô∏è Create a wallet first!"); return; }
  try{
    const res = await fetch(`${API}/mine`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({address})
    });
    const data = await res.json();
    if(data.error) log("‚ö†Ô∏è "+data.error);
    else log(`‚úÖ ${data.message} Block #${data.block.index}`);
    updateDisplay();
  }catch(e){ log("‚ö†Ô∏è Server error"); }
}

function startMining(){
  if(!miningInterval && address){
    miningInterval=setInterval(mineBlock,5000);
    log("‚öôÔ∏è Mining started.");
  }
}

function stopMining(){
  clearInterval(miningInterval);
  miningInterval=null;
  log("üõë Mining stopped.");
}

async function sendTransaction(){
  if(!privKey){ log("‚ö†Ô∏è Create wallet first!"); return; }
  let to=document.getElementById("to").value;
  let amount=parseInt(document.getElementById("amount").value);
  if(!to || !amount || amount<=0){ log("‚ö†Ô∏è Invalid input"); return; }

  try{
    const res=await fetch(`${API}/send`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({from:address,to,amount})
    });
    const data=await res.json();
    if(data.error) log("‚ö†Ô∏è "+data.error);
    else log("‚ûï "+data.message);
    updateDisplay();
  }catch(e){ log("‚ö†Ô∏è Server error"); }
}

function saveWalletAddress(){
  if(!address) { log("‚ö†Ô∏è No wallet to save!"); return; }
  let saved = JSON.parse(localStorage.getItem("KTC_Saved")||"[]");
  if(!saved.includes(address)){
    saved.push(address);
    localStorage.setItem("KTC_Saved", JSON.stringify(saved));
    log("üíæ Address saved: "+address);
    renderSavedWallets();
  }
}

function renderSavedWallets(){
  let saved = JSON.parse(localStorage.getItem("KTC_Saved")||"[]");
  const list=document.getElementById("savedWallets");
  list.innerHTML="";
  saved.forEach(addr=>{
    let li=document.createElement("li");
    li.textContent=addr;
    list.appendChild(li);
  });
}

/* IMPORT WALLET */
async function importWallet(){
  const key = document.getElementById("importPriv").value.trim();
  if(!key || key.length < 20){ log("‚ö†Ô∏è Invalid private key!"); return; }
  privKey = key;
  const addrHash = await hash(privKey);
  address = addrHash.slice(0, 32);
  localStorage.setItem("KTC_Wallet", JSON.stringify({privKey, address}));
  document.getElementById("importModal").style.display = "none";
  log("üîë Wallet imported successfully!");
  updateDisplay();
}

/* COIN RAIN */
function createCoin(){
  const coin=document.createElement("div");
  coin.className="coin";
  coin.innerText="KTC";
  coin.style.left=Math.random()*window.innerWidth+"px";
  coin.style.animationDuration=(3+Math.random()*2)+"s";
  document.body.appendChild(coin);
  setTimeout(()=>coin.remove(),6000);
}
setInterval(createCoin,600);

/* Init */
window.onload=()=>{
  document.getElementById("createWalletBtn").onclick=createWallet;
  document.getElementById("importWalletBtn").onclick=()=>{ document.getElementById("importModal").style.display="flex"; };
  document.getElementById("confirmImportBtn").onclick=importWallet;
  document.getElementById("clearWalletBtn").onclick=clearWallet;
  document.getElementById("startMiningBtn").onclick=startMining;
  document.getElementById("stopMiningBtn").onclick=stopMining;
  document.getElementById("sendBtn").onclick=sendTransaction;
  document.getElementById("saveAddressBtn").onclick=saveWalletAddress;
  document.getElementById("togglePrivBtn").onclick=()=>{ showPriv=!showPriv; updateDisplay(); };
  renderSavedWallets();
  updateDisplay();
};
</script>
</body>
</html>
